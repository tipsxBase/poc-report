"use strict";(self.webpackChunkpoc_report=self.webpackChunkpoc_report||[]).push([["26"],{5340:function(e,n,a){a.r(n),a.d(n,{default:()=>o});var s=a("2676"),c=a("453");let r=a.p+"static/image/20240902165335.f9f37292.png",d=a.p+"static/image/20240902163556.5ff1ab41.png",t=a.p+"static/image/20240902163448.0a78aa58.png",i=a.p+"static/image/20240902165818.87995627.png";function l(e){let n=Object.assign({h1:"h1",a:"a",h2:"h2",p:"p",h3:"h3",ol:"ol",li:"li",strong:"strong",blockquote:"blockquote",code:"code",img:"img",pre:"pre",h4:"h4",br:"br"},(0,c.ah)(),e.components);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.h1,{id:"tpc-h-最佳实践",children:["TPC-H 最佳实践",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#tpc-h-最佳实践",children:"#"})]}),"\n",(0,s.jsxs)(n.h2,{id:"一tpc-h-概述",children:["一、TPC-H 概述",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#一tpc-h-概述",children:"#"})]}),"\n",(0,s.jsx)(n.p,{children:"TPC-H（Transaction Processing Performance Council Benchmark H）是一个由美国交易处理效能委员会（TPC）组织制定的测试基准，专门用于模拟和评估决策支持类应用的性能。\nTPC-H 是一个决策支持基准，通过模拟数据库中与业务相关的复杂查询和并行的数据修改操作，来考察数据库的综合处理能力。主要目的是评价特定查询的决策支持能力，强调服务器在数据挖掘、分析处理方面的能力。"}),"\n",(0,s.jsxs)(n.h3,{id:"12-测试内容",children:["1.2 测试内容",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#12-测试内容",children:"#"})]}),"\n",(0,s.jsx)(n.p,{children:"TPC-H 基准模型涉及 22 条复杂的 SELECT 查询流语句和 2 条带有 INSERT 和 DELETE 程序段的更新流语句。这些查询旨在回答现实世界中的商业问题，模拟生成的即席查询比大多数 OLTP（在线事务处理）事务复杂得多。"}),"\n",(0,s.jsxs)(n.h3,{id:"13-测试工具",children:["1.3 测试工具",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#13-测试工具",children:"#"})]}),"\n",(0,s.jsxs)(n.p,{children:["git 仓库地址：\n",(0,s.jsx)(n.a,{href:"https://codeup.aliyun.com/634e0c6267fa83af64bd0235/hexadb/db-test/tpc-h_v3.0.0/tree/main/TPC-H_Tools_v3.0.0",target:"_blank",rel:"noopener noreferrer",children:"https://codeup.aliyun.com/634e0c6267fa83af64bd0235/hexadb/db-test/tpc-h_v3.0.0/tree/main/TPC-H_Tools_v3.0.0"})]}),"\n",(0,s.jsxs)(n.p,{children:["下载地址：\n",(0,s.jsx)(n.a,{href:"https://codeup.aliyun.com/634e0c6267fa83af64bd0235/hexadb/db-test/tpc-h_v3.0.0/repository/archive.tar.gz?spm=a2cl9.codeup_devops2020_goldlog_projectFiles.0.0.7ff660a6xf34op&ref=main",target:"_blank",rel:"noopener noreferrer",children:"https://codeup.aliyun.com/634e0c6267fa83af64bd0235/hexadb/db-test/tpc-h_v3.0.0/repository/archive.tar.gz?spm=a2cl9.codeup_devops2020_goldlog_projectFiles.0.0.7ff660a6xf34op&ref=main"})]}),"\n",(0,s.jsxs)(n.h2,{id:"二测试步骤",children:["二、测试步骤",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#二测试步骤",children:"#"})]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"下载与编译"}),"：从 TPC 官网下载测试工具和相关文档，并进行编译。"]}),"\n",(0,s.jsx)(n.li,{children:"数据库参数调整"}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"创建数据库与表"}),"，",(0,s.jsx)(n.strong,{children:"导入数据"}),"：根据 TPC-H 模型创建数据库和相应的表，并设置主键等约束。使用提供的工具或脚本将测试数据导入到数据库中。"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"执行测试"}),"：按照 TPC-H 规定的测试流程执行查询和更新操作，并收集测试结果。"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"报告生成"}),"：根据测试结果生成测试报告，包括测试数据库的大小、TPC-H 性能指标（QphH@Size）等信息"]}),"\n"]}),"\n",(0,s.jsxs)(n.h2,{id:"三下载安装",children:["三、下载安装",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#三下载安装",children:"#"})]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"测试工具上传到海纳 DN 节点服务器"}),"\n"]}),"\n",(0,s.jsxs)(n.h3,{id:"31-下载",children:["3.1 下载",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#31-下载",children:"#"})]}),"\n",(0,s.jsxs)(n.p,{children:["下载地址： ",(0,s.jsx)(n.a,{href:"https://codeup.aliyun.com/634e0c6267fa83af64bd0235/hexadb/db-test/tpc-h_v3.0.0/repository/archive.tar.gz?spm=a2cl9.codeup_devops2020_goldlog_projectFiles.0.0.7ff660a6xf34op&ref=main",target:"_blank",rel:"noopener noreferrer",children:"https://codeup.aliyun.com/634e0c6267fa83af64bd0235/hexadb/db-test/tpc-h_v3.0.0/repository/archive.tar.gz?spm=a2cl9.codeup_devops2020_goldlog_projectFiles.0.0.7ff660a6xf34op&ref=main"})]}),"\n",(0,s.jsxs)(n.p,{children:["上传/下载 工具包到服务器 ",(0,s.jsx)(n.code,{children:"/data/software/"}),"目录下"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:i,alt:""})}),"\n",(0,s.jsxs)(n.h3,{id:"32-解压",children:["3.2 解压",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#32-解压",children:"#"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"mkdir -p /data/tpc-h/\ntar -xvf /data/software/tpc-h_v3.0.0-*.tar -C /data/tpc-h/\nmv /data/tpc-h/tpc-h_v3.0.0-* /data/tpc-h/tools\ncd /data/tpc-h/\nchown -R omm:dbgrp *\n"})}),"\n",(0,s.jsxs)(n.h3,{id:"33-编译",children:["3.3 编译",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#33-编译",children:"#"})]}),"\n",(0,s.jsxs)(n.h4,{id:"1-修改datatpc-htoolstpc-h_tools_v300dbgen-目录下的-tpcdh-文件",children:["1. 修改",(0,s.jsx)(n.code,{children:"/data/tpc-h/tools/TPC-H_Tools_v3.0.0/dbgen"})," 目录下的 tpcd.h 文件",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#1-修改datatpc-htoolstpc-h_tools_v300dbgen-目录下的-tpcdh-文件",children:"#"})]}),"\n",(0,s.jsx)(n.p,{children:"添加数据库定义 postgresql"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-c",children:'#ifdef POSTGRESQL\n#define GEN_QUERY_PLAN  "explain"\n#define START_TRAN      "start transaction"\n#define END_TRAN        "commit;"\n#define SET_OUTPUT      ""\n#define SET_ROWCOUNT    "limit %d;\\n"\n#define SET_DBASE       ""\n#endif\n'})}),"\n",(0,s.jsx)(n.p,{children:"修改后示例："}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:t,alt:""})}),"\n",(0,s.jsxs)(n.h4,{id:"2-修改-makefile-文件-配置数据库类型修改后示例",children:["2. 修改 ",(0,s.jsx)(n.code,{children:"Makefile"})," 文件 ，配置数据库类型,修改后示例：",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#2-修改-makefile-文件-配置数据库类型修改后示例",children:"#"})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)("img",{src:d,alt:""})}),"\n",(0,s.jsxs)(n.h4,{id:"3-编译",children:["3. 编译",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#3-编译",children:"#"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"make -f Makefile\n"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:["检查 gcc 是否安装，未安装使用 ",(0,s.jsx)(n.code,{children:"yum instal gcc"})," 安装"]}),"\n"]}),"\n",(0,s.jsxs)(n.h1,{id:"四初始化数据",children:["四、初始化数据",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#四初始化数据",children:"#"})]}),"\n",(0,s.jsxs)(n.p,{children:["回到工具跟目录 ",(0,s.jsx)(n.code,{children:"/data/tpc-h/tools/"})]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["执行 ",(0,s.jsx)(n.code,{children:"sh Build.sh"})," ： 默认生成 500G 数据\n",(0,s.jsx)("img",{src:r,alt:""}),"\n可以修改 Build.sh 中的 Scale 配置生成指定的数据量"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["执行 ",(0,s.jsx)(n.code,{children:"sh Load.sh"})," : 创建数据库及加载数据"]}),"\n",(0,s.jsxs)(n.p,{children:["切换到数据库用户 ",(0,s.jsx)(n.code,{children:"omm"})," 下执行",(0,s.jsx)(n.br,{}),"\n",(0,s.jsx)(n.code,{children:"Load.sh"})," 脚本中的 ",(0,s.jsx)(n.code,{children:"scale"})," 配置要和 Build.sh 保持一致"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.h2,{id:"五数据库参数调整",children:["五、数据库参数调整",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#五数据库参数调整",children:"#"})]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"通用参数调整"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:'cat <<__CN_END__ > cn_guc.$$\nbypass_workload_manager | on\ncheckpoint_segments     | 128\neffective_cache_size    | \'1GB\'\nenable_codegen          | on\nenable_orc_cache        | off\nenable_stream_operator  | off\nenable_wdr_snapshot     | on\ninstr_unique_sql_count  | 200000\nlocal_syscache_threshold| \'16MB\'\nmaintenance_work_mem    | \'256MB\'\nmax_active_statements   | -1\nmax_connections         | 4000\nmax_coordinators        | 128\nmax_datanodes           | 256\nmax_files_per_process   | 1024\nmax_pool_size           | 8192\nmax_replication_slots   | 20\nmax_size_for_xlog_prune | 268435456\nmax_wal_senders         | 20\nmost_available_sync     | off\nrecovery_time_target    | 60\nstandby_shared_buffers_fraction| 1\ntcp_keepalives_count    | 20\ntcp_keepalives_idle     | 60\ntcp_keepalives_interval | 30\nuse_workload_manager    | on\nvacuum_cost_delay       | 1\nvacuum_cost_limit       | 1000\nwal_keep_segments       | 128\nxloginsert_locks        | 16\nwork_mem                | \'128MB\'\n__CN_END__\n\n\ncat <<__DN_END__ > dn_guc.$$\nadvance_xlog_file_num   | 32\nbulk_read_ring_size     | \'2GB\'\nbulk_write_ring_size    | \'2GB\'\nbypass_workload_manager | on\ncheckpoint_segments     | 128\neffective_cache_size    | \'20GB\'\nenable_codegen          | on\nenable_orc_cache        | off\nenable_stream_operator  | off\nenable_wdr_snapshot     | on\ninstr_unique_sql_count  | 200000\nlocal_syscache_threshold| \'16MB\'\nmaintenance_work_mem    | \'256MB\'\nmax_active_statements   | -1\nmax_connections         | 4000\nmax_coordinators        | 128\nmax_datanodes           | 256\nmax_files_per_process   | 1024\nmax_pool_size           | 8192\nmax_replication_slots   | 20\nmax_size_for_xlog_prune | 268435456\nmax_wal_senders         | 20\nmost_available_sync     | off\nrecovery_time_target    | 60\nstandby_shared_buffers_fraction| 1\ntcp_keepalives_count    | 20\ntcp_keepalives_idle     | 60\ntcp_keepalives_interval | 30\nuse_workload_manager    | on\nvacuum_cost_delay       | 1\nvacuum_cost_limit       | 1000\nwal_keep_segments       | 128\nxloginsert_locks        | 16\nwork_mem                | \'128MB\'\n__DN_END__\n\nrm -f set_guc.$$\nawk -F "|" \'BEGIN{O=""}/|/{gsub(/ /, "",$1); gsub(/ /, "",$2); O=O" -c \\x22"$1"="$2"\\x22"}END{print "gs_guc set -Z coordinator -I all -N all", O}\' cn_guc.$$ >> set_guc.$$\nawk -F "|" \'BEGIN{O=""}/|/{gsub(/ /, "",$1); gsub(/ /, "",$2); O=O" -c \\x22"$1"="$2"\\x22"}END{print "gs_guc set -Z datanode    -I all -N all", O}\' dn_guc.$$ >> set_guc.$$\n\nrm -f cn_guc.$$ dn_guc.$$\n\nsh set_guc.$$\nrm set_guc.$$\n'})}),"\n",(0,s.jsxs)(n.p,{children:["服务器上编辑生成 ",(0,s.jsx)(n.code,{children:"general_guc.sh"})," 使用 数据库用户",(0,s.jsx)(n.code,{children:"omm"}),"执行 3. OLAP 参数调整\n脚本"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:'# sort GUC name in alphabetic order!!!\n\ngs_guc set -Z coordinator -I all -N all \\\n    -c "enable_dynamic_workload=on" \\\n    -c "enable_stream_operator=on" \\\n    -c "enable_thread_pool=off" \\\n    -c "cstore_buffers=\'1GB\'" \\\n    -c "query_dop=0" \\\n    -c "max_connections=100" \\\n    -c "shared_buffers=\'256MB\'" \\\n    -c "track_stmt_retention_time=\'18000,604800\'"\n\ngs_guc set -Z datanode -I all -N all \\\n    -c "enable_dynamic_workload=on" \\\n    -c "enable_stream_operator=on" \\\n    -c "enable_thread_pool=off" \\\n    -c "comm_max_stream=4096" \\\n    -c "cstore_buffers=\'4GB\'" \\\n    -c "query_dop=0" \\\n    -c "max_connections=100" \\\n    -c "shared_buffers=\'256MB\'"\n\n'})}),"\n",(0,s.jsxs)(n.p,{children:["服务器上编辑生成 ",(0,s.jsx)(n.code,{children:"olap_guc.sh"})," 使用 数据库用户",(0,s.jsx)(n.code,{children:"omm"}),"执行"]}),"\n",(0,s.jsxs)(n.h2,{id:"六执行测试",children:["六、执行测试",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#六执行测试",children:"#"})]}),"\n",(0,s.jsxs)(n.p,{children:["回到工具跟目录 ",(0,s.jsx)(n.code,{children:"/data/tpc-h/tools/"})]}),"\n",(0,s.jsxs)(n.p,{children:["切换到数据库用户",(0,s.jsx)(n.code,{children:"omm"})," 执行 脚本 ",(0,s.jsx)(n.code,{children:"sh Run.sh"})]}),"\n",(0,s.jsxs)(n.h2,{id:"测试报告",children:["测试报告",(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#测试报告",children:"#"})]}),"\n",(0,s.jsx)(n.p,{children:"参考 TPC-H 测试报告编写"})]})}function h(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,c.ah)(),e.components);return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}let o=h;h.__RSPRESS_PAGE_META={},h.__RSPRESS_PAGE_META["TPC-H%2Findex.md"]={toc:[{text:"一、TPC-H 概述",id:"一tpc-h-概述",depth:2},{text:"1.2 测试内容",id:"12-测试内容",depth:3},{text:"1.3 测试工具",id:"13-测试工具",depth:3},{text:"二、测试步骤",id:"二测试步骤",depth:2},{text:"三、下载安装",id:"三下载安装",depth:2},{text:"3.1 下载",id:"31-下载",depth:3},{text:"3.2 解压",id:"32-解压",depth:3},{text:"3.3 编译",id:"33-编译",depth:3},{text:"1. 修改`/data/tpc-h/tools/TPC-H_Tools_v3.0.0/dbgen` 目录下的 tpcd.h 文件",id:"1-修改datatpc-htoolstpc-h_tools_v300dbgen-目录下的-tpcdh-文件",depth:4},{text:"2. 修改 `Makefile` 文件 ，配置数据库类型,修改后示例：",id:"2-修改-makefile-文件-配置数据库类型修改后示例",depth:4},{text:"3. 编译",id:"3-编译",depth:4},{text:"五、数据库参数调整",id:"五数据库参数调整",depth:2},{text:"六、执行测试",id:"六执行测试",depth:2},{text:"测试报告",id:"测试报告",depth:2}],title:"四、初始化数据",frontmatter:{}}}}]);