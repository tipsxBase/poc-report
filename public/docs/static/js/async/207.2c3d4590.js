"use strict";(self.webpackChunkpoc_report=self.webpackChunkpoc_report||[]).push([["207"],{1666:function(n,e,r){r.r(e),r.d(e,{default:function(){return i}});var s=r(2676),c=r(453);function d(n){let e=Object.assign({h1:"h1",a:"a",h2:"h2",p:"p",strong:"strong",img:"img",ol:"ol",li:"li",h3:"h3",ul:"ul",blockquote:"blockquote",code:"code",pre:"pre",table:"table",thead:"thead",tr:"tr",th:"th",tbody:"tbody",td:"td"},(0,c.ah)(),n.components);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(e.h1,{id:"tpc-c-最佳实践",children:["TPC-C 最佳实践",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#tpc-c-最佳实践",children:"#"})]}),"\n",(0,s.jsxs)(e.h2,{id:"tpc-c-概述",children:["TPC-C 概述",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#tpc-c-概述",children:"#"})]}),"\n",(0,s.jsx)(e.p,{children:"TPC-C 是专门针对联机交易处理系统（OLTP 系统）的规范，也被称为业务处理系统规范。该规范由事务处理性能委员会（Transaction\xa0Processing\xa0Performance\xa0Council，简称 TPC）制定，TPC 是一个由数十家会员公司创建的非盈利组织，主要负责制定商务应用基准程序的标准规范、性能和价格度量，并管理测试结果的发布。 测试目标是通过模拟一个具有高并发、复杂事务的在线事务处理系统，评估计算机系统处理并发事务的能力。"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"官网"}),"\xa0：",(0,s.jsx)(e.a,{href:"https://www.tpc.org/tpcc/default5.asp",target:"_blank",rel:"noopener noreferrer",children:"https://www.tpc.org/tpcc/default5.asp"})]}),"\n",(0,s.jsxs)(e.h2,{id:"测试模型",children:["测试模型",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#测试模型",children:"#"})]}),"\n",(0,s.jsx)(e.p,{children:"TPC-C 测试用到的模型是一个大型的商品批发销售公司，该公司拥有若干个分布在不同区域的商品仓库。当业务扩展时，公司会添加新的仓库。每个仓库负责为 10 个销售点供货，每个销售点为 3000 个客户提供服务。每个客户提交的订单中，平均每个订单有 10 项产品，所有订单中约 1%的产品在其直接所属的仓库中没有存货，必须由其他区域的仓库来供货。同时，每个仓库都要维护公司销售的 100,000 种商品的库存记录。"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{src:"https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/vBPlNYXRr2bVOdG8/img/975c90df-34fa-46d1-b609-4f764b6f0024.png",alt:"Pasted image 20240829173243.png"})}),"\n",(0,s.jsxs)(e.h2,{id:"测试事务说明",children:["测试事务说明",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#测试事务说明",children:"#"})]}),"\n",(0,s.jsx)(e.p,{children:"TPC-C 测试系统需要处理的交易事务主要包括以下几种："}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"新订单（New-Order）"}),"：客户输入一笔新的订货交易。"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"支付操作（Payment）"}),"：更新客户账户余额以反映其支付状况。"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"发货（Delivery）"}),"：发货（模拟批处理交易）。"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"订单状态查询（Order-Status）"}),"：查询客户最近交易的状态。"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"库存状态查询（Stock-Level）"}),"：查询仓库库存状况，以便能够及时补货。"]}),"\n"]}),"\n",(0,s.jsxs)(e.h2,{id:"测试指标",children:["测试指标",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#测试指标",children:"#"})]}),"\n",(0,s.jsxs)(e.h3,{id:"1-流量指标throughput简称-tpmc",children:["1. 流量指标（Throughput，简称 tpmC）：",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#1-流量指标throughput简称-tpmc",children:"#"})]}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"定义：按照 TPC 组织的定义，流量指标描述了系统在执行支付操作、订单状态查询、发货和库存状态查询这 4 种交易的同时，每分钟可以处理多少个新订单交易。"}),"\n",(0,s.jsx)(e.li,{children:"评估标准：所有交易的响应时间必须满足 TPC-C 测试规范的要求，且各种交易数量所占的比例也应该满足 TPC-C 测试规范的要求。流量指标值越大，说明系统的联机事务处理能力越高。"}),"\n"]}),"\n",(0,s.jsxs)(e.h3,{id:"2-性价比priceperformance简称-pricetpmc",children:["2. 性价比（Price/Performance，简称 Price/tpmC）：",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#2-性价比priceperformance简称-pricetpmc",children:"#"})]}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"定义：即测试系统的整体价格（单位为美元）与流量指标的比值。"}),"\n",(0,s.jsx)(e.li,{children:"评估标准：在获得相同的 tpmC 值的情况下，价格越低越好。"}),"\n"]}),"\n",(0,s.jsxs)(e.h2,{id:"测试工具",children:["测试工具",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#测试工具",children:"#"})]}),"\n",(0,s.jsx)(e.p,{children:"我们使用 \xa0BenchmarkSQL\xa0 来作为 \xa0TPC-C\xa0 测试工具，BenchmarkSQL 是一款用于数据库性能测试的开源工具，它遵循 TPC-C（Transaction\xa0Processing\xa0Performance\xa0Council-C）规范来模拟一个订单处理系统的工作负载，以便对关系型数据库进行压力测试和性能评估。"}),"\n",(0,s.jsxs)(e.h2,{id:"测试流程",children:["测试流程",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#测试流程",children:"#"})]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{src:"https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/vBPlNYXRr2bVOdG8/img/7a189374-454c-4c7b-91b3-109c99f72dac.png",alt:"Pasted image 20240829182611.png"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"安装"})}),"\n",(0,s.jsx)(e.p,{children:"需要准备一个独立于数据库服务器的负载机进行 TPC-C 测试，以免对数据库实际性能表现有影响。负载机建议 4C8G 以上的配置。"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"依赖工具包"})}),"\n",(0,s.jsxs)(e.blockquote,{children:["\n",(0,s.jsx)(e.p,{children:"OpenJDK\xa0>=17 BenchmarkSQL\xa0>=5.0 nmon\xa0>=16 ant"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"工具包下载"})}),"\n",(0,s.jsxs)(e.p,{children:["BenchmarkSQL\xa0 工具包下载链接：",(0,s.jsx)(e.a,{href:"https://codeup.aliyun.com/634e0c6267fa83af64bd0235/hexadb/db-test/benchmarksql-5.0/repository/archive.zip?spm=a2cl9.codeup_devops2020_goldlog_projectFiles.0.0.42e87e6azSp1zH&ref=main",target:"_blank",rel:"noopener noreferrer",children:(0,s.jsx)(e.a,{href:"https://codeup.aliyun.com/634e0c6267fa83af64bd0235/hexadb/db-test/benchmarksql-5.0/repository/archive.zip?spm=a2cl9.codeup_devops2020_goldlog_projectFiles.0.0.42e87e6azSp1zH&ref=main",target:"_blank",rel:"noopener noreferrer",children:"https://codeup.aliyun.com/634e0c6267fa83af64bd0235/hexadb/db-test/benchmarksql-5.0/repository/archive.zip?spm=a2cl9.codeup_devops2020_goldlog_projectFiles.0.0.42e87e6azSp1zH&ref=main"})})]}),"\n",(0,s.jsxs)(e.blockquote,{children:["\n",(0,s.jsx)(e.p,{children:"无下载权限联系 \xa0@李兆伟"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.a,{href:"https://alidocs.dingtalk.com/i/nodes/ndMj49yWjjggvKXDtrpRAQM9W3pmz5aA?iframeQuery=anchorId%3DX02m0gjtcw4gzc61q6h0rt",target:"_blank",rel:"noopener noreferrer",children:"请至钉钉文档查看附件《benchmarksql-5.0.tar》"})}),"\n",(0,s.jsx)(e.p,{children:"服务器性能监控工具 Nmon 下载："}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.a,{href:"https://nmon.sourceforge.io/pmwiki.php?n=Site.Download",target:"_blank",rel:"noopener noreferrer",children:"https://nmon.sourceforge.io/pmwiki.php?n=Site.Download"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.a,{href:"https://alidocs.dingtalk.com/i/nodes/ndMj49yWjjggvKXDtrpRAQM9W3pmz5aA?iframeQuery=anchorId%3DX02m0gju3n73o195cyc005",target:"_blank",rel:"noopener noreferrer",children:"请至钉钉文档查看附件《nmon16p_32_binaries_feb_2024.tar.gz》"})}),"\n",(0,s.jsx)(e.p,{children:"JDK\xa0 下载"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.a,{href:"https://mirror.tuna.tsinghua.edu.cn/Adoptium/17/jdk/x64/linux/OpenJDK17U-jdk%5C_x64%5C_linux%5C_hotspot%5C_17.0.12%5C_7.tar.gz",target:"_blank",rel:"noopener noreferrer",children:"https://mirror.tuna.tsinghua.edu.cn/Adoptium/17/jdk/x64/linux/OpenJDK17U-jdk\\_x64\\_linux\\_hotspot\\_17.0.12\\_7.tar.gz"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.a,{href:"https://alidocs.dingtalk.com/i/nodes/ndMj49yWjjggvKXDtrpRAQM9W3pmz5aA?iframeQuery=anchorId%3DX02m0gjugovj7f0b93qef",target:"_blank",rel:"noopener noreferrer",children:"请至钉钉文档查看附件《OpenJDK17U-jdk_x64_linux_hotspot_17.0.12_7.tar.gz》"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"上传及解压"})}),"\n",(0,s.jsxs)(e.p,{children:["使用 Ftp\xa0 工具或者使用 \xa0",(0,s.jsx)(e.code,{children:"scp"}),"\xa0 命令上传到负载机。\xa0 上传后服务器安装包示例： ",(0,s.jsx)(e.img,{src:"https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/vBPlNYXRr2bVOdG8/img/d825e725-e786-46bf-8b32-693a7c2ba83a.png",alt:"Pasted image 20240829182704.png"})]}),"\n",(0,s.jsx)(e.p,{children:"解压"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-shell",children:'mkdir -p /data/tpc-c/nmon\nmkdir -p /data/tpc-c/benchmark\nmkdir -p /data/tpc-c/jdk\n\necho "解压benchmark"\ntar -xvf /data/software/benchmarksql-5.0.tar -C /data/tpc-c/benchmark/\nmv /data/tpc-c/benchmark/benchmark-5.0-main*/* /data/tpc-c/benchmark/\nrm -rf benchmarksql-5.0-main*\n\necho "解压nmon"\ntar -xvf /data/software/nmon*.tar.gz -C /data/tpc-c/nmon/\n## 注意对应的操作系统\nmv /data/tpc-c/nmon/nmon_x86_64_centos7 /data/tpc-c/nmon/nmon\necho "解压jdk"\ntar -xvf /data/software/OpenJDK17U-jdk_x64_linux_hotspot_17.0.12_7.tar.gz -C /data/tpc-c/jdk/\nmv /data/tpc-c/jdk/jdk-17*/* /data/tpc-c/jdk/\nrm -rf jdk-17*\n\n'})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"安装"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-shell",children:'echo "export JAVA_HOME=/data/tpc-c/jdk" >>/etc/profile\necho "export PATH=$JAVA_HOME/bin:/data/tpc-c/nmon:$PATH" >> /etc/profile\n\nsource /etc/profile\n\nyum install -y ant\n\ncd /data/tpc-c/benchmark & ant\n'})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"配置"})}),"\n",(0,s.jsxs)(e.p,{children:["进行数据库连接配置，配置文件位置示例： ",(0,s.jsx)(e.img,{src:"https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/vBPlNYXRr2bVOdG8/img/4b89fa19-e3e0-444a-8381-53232783e02c.png",alt:"Pasted image 20240829195249.png"})]}),"\n",(0,s.jsxs)(e.p,{children:["使用 \xa0",(0,s.jsx)(e.code,{children:"vi"}),"\xa0 或 \xa0",(0,s.jsx)(e.code,{children:"vim"}),"命令 \xa0 编辑配置文件 关键配置项如下： ",(0,s.jsx)(e.img,{src:"https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/vBPlNYXRr2bVOdG8/img/3975841c-6982-4b14-ad2c-9b0cbad135f2.png",alt:"Pasted image 20240829195513.png"})]}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"db\xa0:\xa0 数据库类型"}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsx)(e.li,{children:"海纳：hexadb"}),"\n",(0,s.jsx)(e.li,{children:"PostgreSQL:\xa0postgres"}),"\n",(0,s.jsx)(e.li,{children:"Oracle:\xa0oracle"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"driver:\xa0 数据库连接驱动"}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"conn:\xa0 数据库连接字符串，注意数据库地址端口"}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"user:\xa0 数据库用户名"}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"password:\xa0 数据库用户密码"}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"warehouses:\xa0 数仓数量，要测试的数据量"}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"loadWorkers:\xa0 数仓加载线程数量，过大会导致数据库负载超限，根据数据实际负载能力进行设置，建议值 \xa030-50"}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"terminals:\xa0TPC-C\xa0 测试并发数量 \xa0300-1000\xa0 根据数据库实际负载进行配置"}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"runMins:\xa0 测试运行时长 \xa010-20"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.blockquote,{children:["\n",(0,s.jsx)(e.p,{children:"注意 \xa0conn\xa0 中 \xa0 指定数据库名 \xa0，也可以在连接串中指定 schema 建议创建测试数据库 tpcc"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"数据库参数配置"})}),"\n",(0,s.jsx)(e.p,{children:"对数据库参数进行调优，以发挥数据库最大性能表现。"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"general"})}),"\n",(0,s.jsxs)(e.p,{children:["服务器使用 \xa0",(0,s.jsx)(e.code,{children:"vi"}),"\xa0 命令"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-shell",children:"mkdir -p /data/performance\nvi /data/performance/general_guc.sh\n"})}),"\n",(0,s.jsx)(e.p,{children:"把以下脚本拷贝文件中"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sh",children:'\ncat <<__CN_END__ > cn_guc.$$\nbypass_workload_manager | on\ncheckpoint_segments     | 128\neffective_cache_size    | \'1GB\'\nenable_codegen          | on\nenable_orc_cache        | off\nenable_stream_operator  | off\nenable_wdr_snapshot     | on\ninstr_unique_sql_count  | 200000\nlocal_syscache_threshold| \'16MB\'\nmaintenance_work_mem    | \'256MB\'\nmax_active_statements   | -1\nmax_connections         | 4000\nmax_coordinators        | 128\nmax_datanodes           | 256\nmax_files_per_process   | 1024\nmax_pool_size           | 8192\nmax_replication_slots   | 20\nmax_size_for_xlog_prune | 268435456\nmax_wal_senders         | 20\nmost_available_sync     | off\nrecovery_time_target    | 60\nstandby_shared_buffers_fraction| 1\ntcp_keepalives_count    | 20\ntcp_keepalives_idle     | 60\ntcp_keepalives_interval | 30\nuse_workload_manager    | on\nvacuum_cost_delay       | 1\nvacuum_cost_limit       | 1000\nwal_keep_segments       | 128\nxloginsert_locks        | 16\nwork_mem                | \'128MB\'\n__CN_END__\n\n\ncat <<__DN_END__ > dn_guc.$$\nadvance_xlog_file_num   | 32\nbulk_read_ring_size     | \'2GB\'\nbulk_write_ring_size    | \'2GB\'\nbypass_workload_manager | on\ncheckpoint_segments     | 128\neffective_cache_size    | \'20GB\'\nenable_codegen          | on\nenable_orc_cache        | off\nenable_stream_operator  | off\nenable_wdr_snapshot     | on\ninstr_unique_sql_count  | 200000\nlocal_syscache_threshold| \'16MB\'\nmaintenance_work_mem    | \'256MB\'\nmax_active_statements   | -1\nmax_connections         | 4000\nmax_coordinators        | 128\nmax_datanodes           | 256\nmax_files_per_process   | 1024\nmax_pool_size           | 8192\nmax_replication_slots   | 20\nmax_size_for_xlog_prune | 268435456\nmax_wal_senders         | 20\nmost_available_sync     | off\nrecovery_time_target    | 60\nstandby_shared_buffers_fraction| 1\ntcp_keepalives_count    | 20\ntcp_keepalives_idle     | 60\ntcp_keepalives_interval | 30\nuse_workload_manager    | on\nvacuum_cost_delay       | 1\nvacuum_cost_limit       | 1000\nwal_keep_segments       | 128\nxloginsert_locks        | 16\nwork_mem                | \'128MB\'\n__DN_END__\n\nrm -f set_guc.$$\nawk -F "|" \'BEGIN{O=""}/|/{gsub(/ /, "",$1); gsub(/ /, "",$2); O=O" -c \\x22"$1"="$2"\\x22"}END{print "gs_guc set -Z coordinator -I all -N all", O}\' cn_guc.$$ >> set_guc.$$\nawk -F "|" \'BEGIN{O=""}/|/{gsub(/ /, "",$1); gsub(/ /, "",$2); O=O" -c \\x22"$1"="$2"\\x22"}END{print "gs_guc set -Z datanode    -I all -N all", O}\' dn_guc.$$ >> set_guc.$$\n\nrm -f cn_guc.$$ dn_guc.$$\n\nsh set_guc.$$\nrm set_guc.$$\n\n'})}),"\n",(0,s.jsx)(e.p,{children:"执行"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-shell",children:"sh /data/performance/general_guc.sh\n"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"OLTP"})}),"\n",(0,s.jsx)(e.p,{children:"编辑并执行 \xa0/data/performance/oltp_guc.sh"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sh",children:'\n# sort in alphabetic order!!!\n\ngs_guc set -Z coordinator -I all -N all \\\n    -c "enable_dynamic_workload=off" \\\n    -c "enable_stream_operator=off" \\\n    -c "enable_thread_pool=off" \\\n    -c "max_prepared_transactions=2048" \\\n    -c "query_dop=1" \\\n    -c "recovery_time_target=0" \\\n    -c "shared_buffers=\'2GB\'" \\\n    -c "thread_pool_attr=\'576,2,(nobind)\'" \\\n    -c "update_lockwait_timeout=1200000"\n\n\ngs_guc set -Z datanode -I all -N all \\\n    -c "enable_dynamic_workload=off" \\\n    -c "enable_stream_operator=off" \\\n    -c "enable_thread_pool=off" \\\n    -c "max_prepared_transactions=2048" \\\n    -c "query_dop=1" \\\n    -c "recovery_time_target=0" \\\n    -c "shared_buffers=\'32GB\'" \\\n    -c "thread_pool_attr=\'576,2,(nobind)\'" \\\n    -c "update_lockwait_timeout=1200000"\n\n'})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"注意："})}),"\n",(0,s.jsxs)(e.blockquote,{children:["\n",(0,s.jsxs)(e.p,{children:["检查内存设置参数 \xa0max_process_memory\xa0,shared_buffers:\xa0 登录数据库服务器使用",(0,s.jsx)(e.code,{children:"gsql"}),"\xa0 元命令查看 ",(0,s.jsx)(e.code,{children:" show\xa0max_process_memory``show\xa0shared_buffers "})," max_process_memory\xa0=\xa0 服务总内存/节点数量 shared_buffers\xa0 参数值调高可以提高查询性能，当前场景下建议值为 \xa0\xa0max_process_memory/2"]}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"执行数据库参数调整后需要重启数据库，进入数据库 CN 节点服务器执行如下命令："}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-shell",children:"cm_ctl stop\ncm_ctl start\n"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"数据初始化"})}),"\n",(0,s.jsxs)(e.p,{children:["在环境配置好之后，我们就可以进行数据初始化工作了，这一步主要使用",(0,s.jsx)(e.code,{children:"BenchmarkSQL"}),"\xa0 工具进行。"]}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsx)(e.li,{children:"登录负载服务器，编辑运行如下脚本："}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sh",children:"mkdir -p /data/tpc-c/logs\nnohup sh /data/tpc-c/benchmark/run/runDatabaseBuild.sh > /data/tpc-c/logs/load_data.log 2>&1 &\ntail -f /data/tpc-c/logs/load_data.log\n"})}),"\n",(0,s.jsxs)(e.ol,{start:"2",children:["\n",(0,s.jsxs)(e.li,{children:["观察日志，比如我们初始化 10 仓数据，日志输出 \xa0",(0,s.jsx)(e.code,{children:"Loading\xa0Warehouse\xa010\xa0done"}),"\xa0\xa0 说明数据初始化成功。 ",(0,s.jsx)(e.img,{src:"https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/vBPlNYXRr2bVOdG8/img/ddfef7f4-bb6c-48d2-9e14-674cd9958489.png",alt:"Pasted image 20240830141211.png"})]}),"\n",(0,s.jsx)(e.li,{children:"观察索引创建情况，出现下图时成功"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{src:"https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/vBPlNYXRr2bVOdG8/img/2fca18ff-7042-4cce-9060-ab8e1c4a0a9d.png",alt:"Pasted image 20240830141857.png"})}),"\n",(0,s.jsxs)(e.blockquote,{children:["\n",(0,s.jsx)(e.p,{children:"有一些外键创建失败，忽略该错误"}),"\n"]}),"\n",(0,s.jsxs)(e.ol,{start:"4",children:["\n",(0,s.jsx)(e.li,{children:"初始化后查看数据新"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"查询表结构是否正确（主键、索引） 查询表数据量和数据存储大小"}),"\n",(0,s.jsxs)(e.ol,{start:"5",children:["\n",(0,s.jsx)(e.li,{children:"异常情况处理"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"数据初始化中的一些异常、错误请联系 DBA 进行处理。"}),"\n",(0,s.jsx)(e.p,{children:"清除数据命令："}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-shell",children:"sh runDatabaseDestroy.sh hexadb.properties\n"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"性能监控"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"监控指标"})}),"\n",(0,s.jsx)(e.p,{children:"TPC-C\xa0 测试运行期间的性能监控分 \xa0 服务器监控和数据库监控两部分，监控的指标项为："}),"\n",(0,s.jsxs)(e.table,{children:["\n",(0,s.jsxs)(e.thead,{children:["\n",(0,s.jsxs)(e.tr,{children:["\n",(0,s.jsx)(e.th,{children:(0,s.jsx)(e.strong,{children:"序号"})}),"\n",(0,s.jsx)(e.th,{children:(0,s.jsx)(e.strong,{children:"指标项"})}),"\n",(0,s.jsx)(e.th,{children:(0,s.jsx)(e.strong,{children:"类别"})}),"\n",(0,s.jsx)(e.th,{children:(0,s.jsx)(e.strong,{children:"采集周期"})}),"\n",(0,s.jsx)(e.th,{children:(0,s.jsx)(e.strong,{children:"监控工具"})}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.tbody,{children:["\n",(0,s.jsxs)(e.tr,{children:["\n",(0,s.jsx)(e.td,{children:"1"}),"\n",(0,s.jsx)(e.td,{children:"CPU 使用率"}),"\n",(0,s.jsx)(e.td,{children:"服务器监控"}),"\n",(0,s.jsx)(e.td,{children:"10s"}),"\n",(0,s.jsx)(e.td,{children:"nmon"}),"\n"]}),"\n",(0,s.jsxs)(e.tr,{children:["\n",(0,s.jsx)(e.td,{children:"2"}),"\n",(0,s.jsx)(e.td,{children:"内存使用及占比"}),"\n",(0,s.jsx)(e.td,{children:"服务器监控"}),"\n",(0,s.jsx)(e.td,{children:"10s"}),"\n",(0,s.jsx)(e.td,{children:"nmon"}),"\n"]}),"\n",(0,s.jsxs)(e.tr,{children:["\n",(0,s.jsx)(e.td,{children:"3"}),"\n",(0,s.jsx)(e.td,{children:"磁盘 IO"}),"\n",(0,s.jsx)(e.td,{children:"服务器监控"}),"\n",(0,s.jsx)(e.td,{children:"10s"}),"\n",(0,s.jsx)(e.td,{children:"nmon"}),"\n"]}),"\n",(0,s.jsxs)(e.tr,{children:["\n",(0,s.jsx)(e.td,{children:"4"}),"\n",(0,s.jsx)(e.td,{children:"网络 IO"}),"\n",(0,s.jsx)(e.td,{children:"服务器监控"}),"\n",(0,s.jsx)(e.td,{children:"10s"}),"\n",(0,s.jsx)(e.td,{children:"nmon"}),"\n"]}),"\n",(0,s.jsxs)(e.tr,{children:["\n",(0,s.jsx)(e.td,{children:"5"}),"\n",(0,s.jsx)(e.td,{children:"节点内存使用"}),"\n",(0,s.jsx)(e.td,{children:"数据库监控"}),"\n",(0,s.jsx)(e.td,{children:"30s"}),"\n",(0,s.jsx)(e.td,{children:"司南 or\xa0 脚本"}),"\n"]}),"\n",(0,s.jsxs)(e.tr,{children:["\n",(0,s.jsx)(e.td,{children:"6"}),"\n",(0,s.jsx)(e.td,{children:"QPS"}),"\n",(0,s.jsx)(e.td,{children:"数据库监控"}),"\n",(0,s.jsx)(e.td,{children:"30s"}),"\n",(0,s.jsx)(e.td,{children:"司南 or\xa0 脚本"}),"\n"]}),"\n",(0,s.jsxs)(e.tr,{children:["\n",(0,s.jsx)(e.td,{children:"7"}),"\n",(0,s.jsx)(e.td,{children:"响应时间"}),"\n",(0,s.jsx)(e.td,{children:"数据库监控"}),"\n",(0,s.jsx)(e.td,{children:"30s"}),"\n",(0,s.jsx)(e.td,{children:"司南 or\xa0 脚本"}),"\n"]}),"\n",(0,s.jsxs)(e.tr,{children:["\n",(0,s.jsx)(e.td,{children:"8"}),"\n",(0,s.jsx)(e.td,{children:"会话数"}),"\n",(0,s.jsx)(e.td,{children:"数据库监控"}),"\n",(0,s.jsx)(e.td,{children:"30s"}),"\n",(0,s.jsx)(e.td,{children:"司南 or\xa0 脚本"}),"\n"]}),"\n",(0,s.jsxs)(e.tr,{children:["\n",(0,s.jsx)(e.td,{children:"9"}),"\n",(0,s.jsx)(e.td,{children:"连接数"}),"\n",(0,s.jsx)(e.td,{children:"数据库监控"}),"\n",(0,s.jsx)(e.td,{children:"30s"}),"\n",(0,s.jsx)(e.td,{children:"司南 or\xa0 脚本"}),"\n"]}),"\n",(0,s.jsxs)(e.tr,{children:["\n",(0,s.jsx)(e.td,{children:"10"}),"\n",(0,s.jsx)(e.td,{children:"TPS"}),"\n",(0,s.jsx)(e.td,{children:"数据库监控"}),"\n",(0,s.jsx)(e.td,{children:"30s"}),"\n",(0,s.jsx)(e.td,{children:"司南 or\xa0 脚本"}),"\n"]}),"\n",(0,s.jsxs)(e.tr,{children:["\n",(0,s.jsx)(e.td,{children:"11"}),"\n",(0,s.jsx)(e.td,{children:"事务响应时间"}),"\n",(0,s.jsx)(e.td,{children:"数据库监控"}),"\n",(0,s.jsx)(e.td,{children:"30s"}),"\n",(0,s.jsx)(e.td,{children:"司南 or\xa0 脚本"}),"\n"]}),"\n",(0,s.jsxs)(e.tr,{children:["\n",(0,s.jsx)(e.td,{children:"12"}),"\n",(0,s.jsx)(e.td,{children:"事务锁等待次数"}),"\n",(0,s.jsx)(e.td,{children:"数据库监控"}),"\n",(0,s.jsx)(e.td,{children:"30s"}),"\n",(0,s.jsx)(e.td,{children:"司南 or\xa0 脚本"}),"\n"]}),"\n",(0,s.jsxs)(e.tr,{children:["\n",(0,s.jsx)(e.td,{children:"13"}),"\n",(0,s.jsx)(e.td,{children:"事务数量"}),"\n",(0,s.jsx)(e.td,{children:"数据库监控"}),"\n",(0,s.jsx)(e.td,{children:"30s"}),"\n",(0,s.jsx)(e.td,{children:"司南 or\xa0 脚本"}),"\n"]}),"\n",(0,s.jsxs)(e.tr,{children:["\n",(0,s.jsx)(e.td,{children:"14"}),"\n",(0,s.jsx)(e.td,{children:"P80"}),"\n",(0,s.jsx)(e.td,{children:"数据库监控"}),"\n",(0,s.jsx)(e.td,{children:"30s"}),"\n",(0,s.jsx)(e.td,{children:"司南 or\xa0 脚本"}),"\n"]}),"\n",(0,s.jsxs)(e.tr,{children:["\n",(0,s.jsx)(e.td,{children:"15"}),"\n",(0,s.jsx)(e.td,{children:"p95"}),"\n",(0,s.jsx)(e.td,{children:"数据库监控"}),"\n",(0,s.jsx)(e.td,{children:"30s"}),"\n",(0,s.jsx)(e.td,{children:"司南 or\xa0 脚本"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"监控工具"})}),"\n",(0,s.jsxs)(e.h3,{id:"有司南",children:["有司南",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#有司南",children:"#"})]}),"\n",(0,s.jsx)(e.p,{children:"使用司南进行数据库集群监控"}),"\n",(0,s.jsxs)(e.h3,{id:"无司南",children:["无司南",(0,s.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#无司南",children:"#"})]}),"\n",(0,s.jsxs)(e.p,{children:["使用 nmon\xa0 进行数据库服务器监控，要对所有数据库服务器进行 nmon\xa0 安装。 执行命令",(0,s.jsx)(e.code,{children:"nmon\xa0-fT\xa0-s\xa010\xa0-c\xa0720"}),"\xa0 开启监控。该命令每 10 秒采集一次数据，采集 2 小时"]}),"\n",(0,s.jsx)(e.p,{children:"数据库性能监控脚本暂无 \xa0，待补充。"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"执行测试"})}),"\n",(0,s.jsx)(e.p,{children:"正式开始测试前检查 \xa0 测试配置，重点关注下"}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsx)(e.li,{children:"terminals\xa0:\xa0 并发量"}),"\n",(0,s.jsx)(e.li,{children:"runMins:\xa0 运行时间"}),"\n",(0,s.jsx)(e.li,{children:"监控工具是否开启"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"使用如下命令开始 TPC-C 测试"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-shell",children:"cd /data/tpc-c/benchmark/run\n./runBenchmark.sh props.hexadb > tpcc.log 2>&1 &\n"})}),"\n",(0,s.jsxs)(e.blockquote,{children:["\n",(0,s.jsx)(e.p,{children:"需要执行 3 次以上的 TPC-C\xa0 测试，获取数据库最稳定的性能表现"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"测试报告"})}),"\n",(0,s.jsx)(e.p,{children:"测试报告参考 \xa0："})]})}function l(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}=Object.assign({},(0,c.ah)(),n.components);return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(d,{...n})}):d(n)}let i=l;l.__RSPRESS_PAGE_META={},l.__RSPRESS_PAGE_META["tpcc%2Findex.md"]={toc:[{text:"TPC-C 概述",id:"tpc-c-概述",depth:2},{text:"测试模型",id:"测试模型",depth:2},{text:"测试事务说明",id:"测试事务说明",depth:2},{text:"测试指标",id:"测试指标",depth:2},{text:"1. 流量指标（Throughput，简称 tpmC）：",id:"1-流量指标throughput简称-tpmc",depth:3},{text:"2. 性价比（Price/Performance，简称 Price/tpmC）：",id:"2-性价比priceperformance简称-pricetpmc",depth:3},{text:"测试工具",id:"测试工具",depth:2},{text:"测试流程",id:"测试流程",depth:2},{text:"有司南",id:"有司南",depth:3},{text:"无司南",id:"无司南",depth:3}],title:"TPC-C 最佳实践",frontmatter:{}}}}]);